{% extends "layout.html" %}
{% block body %}
{% if "archieml" in session.options %}
<link href="{{ url_for('static', filename='css/archieml.css') }}" media="screen, projection" rel="stylesheet" type="text/css" />
<script src="{{ url_for('static', filename='js/archieml.js') }}"></script>
{% if "mpfile" in session and session.options|length == 2 %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}" type="text/css"/>
<link rel="stylesheet" href="{{ url_for('static', filename='css/codemirror.min.css') }}" type="text/css"/>
<script src="{{ url_for('static', filename='js/main-built.js') }}" type="text/javascript" charset="utf-8"></script>
<script>
$(function(){
  var thebe = new Thebe({
    tmpnb_mode: false,
    add_interrupt_button: true,
    url: 'http://localhost:8888/'
  });
});
</script>
<div class="container">
  <pre data-executable='true'>
# Pre-submission processing loaded below for project "{{ session.options[1] }}".
# Click "Load MPFile" to reload MPFile from ArchieML Sandbox.
%load_ext autoreload
%autoreload 2
from mpcontribs.io.{{ session.options[0] }}.mpfile import MPFile
from mpcontribs.users.{{ session.options[1] }}.pre_submission import run
  </pre>
  <pre data-executable='true'>
# Click "Run"/"Run Again"; file reading and writing is handled automatically.
# The resulting output MPFile is used for "View MPFile/Graphs".
# Start from scratch by clicking "Home".
mpfile = MPFile.from_file()
run(mpfile)
mpfile.write_file()
  </pre>
</div>
{% endif %}
<div class="sandbox">
  <div class="container"><br>
    <div class="row">
      <div class="col-md-6"><strong>edit MPFile contents (ArchieML Sandbox):</strong></div>
      <div class="col-md-6"><strong>live-preview of JSON representation after default ArchieML parsing:</strong></div>
    </div>
{% if "mpfile" in session %}
<aml>{{session.mpfile|safe}}</aml>
{% else %}
<aml>This is an example MPFile in the ArchieML format.

Experiment.Preparation: Sputter deposition

{Experiment.Sample}
Material: Vicalloy
Authors: Contact Alpha T. N'Diaye (atndiaye@lbl.gov)

{Experiment.Measurement}
Detection: total electron yield
Temperature: RT
Orientation: 30° grazing incidence

{Experiment.Measurement.Beamline}
Beamline: ALS-6.3.1
Method: Soft x-ray XAS and XMCD
Monochromator.Exit_Slit: 20µm
Monochromator.Grating: 600l/mm

{Datasource}
directory: Vicalloy/rawdata
group_by: Z Y

{Fe_XMCD}
get_xmcd.energy_range: 690 740
scaling_preedge_to_1.preedge_range: 690 700
linear_background_removal_preedge_XAS.preedge_range: 690 700
xas_normalization_to_min_and_max.energy_range: 690 740
xas_xmcd_minmax:

[+AlNiCoCu.datatable]
Energy,XAS,XMCD
761,0.008445,-0.001452
762,0.007812,-0.000682

[+AlNiCoCu.table2]
Energy,XAS,XMCD
761,0.008445,-0.001452
762,0.007812,-0.000682

:ignore

[.processing]
* scaling background to 1
* constant background removal preedge
* normalization to L3

</aml>
{% endif %}
  </div>
</div>
<script type="text/javascript">
var qs = window.location.search.substring(1);
qs.split('&').forEach(function(term) {
  var temp = term.split('=');
  if (temp[0] == 'aml') {
    var source = decodeURIComponent(temp[1].replace(/\+/g, " "));
    var aml = document.getElementsByTagName('aml')[0];
    aml.innerHTML = source;
  }
});
</script>
<script src="{{ url_for('static', filename='js/sandbox.js') }}"></script>
{% endif %}
{% endblock %}
