{% extends "layout.html" %}
{% block body %}
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <div class="alert alert-warning" role="alert" style="position:relative; height:150px; overflow:hidden;">
        <div id='output' style="position:absolute; bottom:0; width:100%;"></div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-2">
      <div class="dropdown">
        <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenu1"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Go to contribution ... <span class="caret"></span>
        </button>
        <ul id="gotolist" class="dropdown-menu" aria-labelledby="dropdownMenu1"></ul>
      </div>
    </div>
    <div class="col-md-1">
      <button id="toggle_graphs" type="button" class="btn btn-success">Show Graphs Only</button>
    </div>
    <div class="col-md-9"></div>
  </div>
  {% for c in content: %}
  {% if c is string %}
  <script>$("#output").append("{{ c|safe }}");</script>
  {% elif c is mapping %}
  {% for k,v in c.iteritems() %}
  {{ k }}:</br>
  {% for kk,vv in v.iteritems() %}
  {{ kk }}</br>
  {% endfor %}
  {% endfor %}
  {% elif c is sequence %}
  <script>
    var list = document.getElementById('gotolist');
    var entry = document.createElement('li');
    var a = document.createElement('a');
    var entry_text = "{{ c[0] }} (#{{ c[2] }})";
    a.appendChild(document.createTextNode(entry_text));
    a.href = "#cid{{ c[2] }}";
    entry.appendChild(a);
    list.appendChild(entry);
  </script>
  <div class="row">
    <div class="col-md-12">
      <hr><a name="cid{{ c[2] }}"></a>
      <div name="main_header_all">
        <h1>
          {{ c[0] }} &raquo; {{ c[1] }} &raquo; #{{ c[2] }}
          <a href="#top" class="btn btn-default btn-xs pull-right" role="button">back to top</a>
        </h1>
      </div>
      <div name="main_header_graph" style="display:none">
        <strong>#{{ c[2] }}</strong>
        <a href="#top" class="btn btn-default btn-xs pull-right" role="button">back to top</a>
      </div>
    </div>
  </div>
  <div class="row" name="tree_row">
    <div class="col-md-12">
      <a name="{{ c[2] }}_jump_tree"></a><h2>Hierarchical Data</h2>
      {% if "tree_data" in c[3] %}
      <div id="{{ c[2] }}_tree"></div>
      <script type="text/jsx">
      /** @jsx React.DOM */
      var lol = {{ c[3]['tree_data']|tojson|safe }};
      React.renderComponent(
          <JSONTree data={lol} />, document.getElementById('{{ c[2] }}_tree')
      );
      </script>
      {% endif %}
    </div>
  </div>
  <div class="row" name="table_row">
    <div class="col-md-12">
      <a name="{{ c[2] }}_jump_tables"></a><h2>Tables</h2>
      {% if 'tables' in c[3] %}
      {% for table_name,table_data in c[3]['tables'].iteritems() %}
      <p>
        <b>{{ table_name }}</b>
        <button class="btn btn-primary btn-xs" type="button" data-toggle="collapse"
            data-target="#{{ c[2] }}_{{ loop.index }}_collapse" aria-expanded="false"
            aria-controls="{{ c[2] }}_{{ loop.index }}_collapse">
          Collapse/Expand
        </button>
        <div class="collapse" id="{{ c[2] }}_{{ loop.index }}_collapse">
          <table id="{{ c[2] }}_{{ loop.index }}_table" class="table"></table>
          <script>
          var table = {{ table_data|tojson|safe }};
          $('#{{ c[2] }}_{{ loop.index }}_table').DataTable({
            "data": table['rows'], "columns": table['columns'], "scrollX": true,
            "scrollY": "300px", "scrollCollapse": true, "paging": false
          });
          </script>
        </div>
      </p>
      {% endfor %}
      {% endif %}
    </div>
  </div>
  <div class="row" name="main_header_all">
    <div class="col-md-12">
      <a name="{{ c[2] }}_jump_graphs"></a><h2>Graphs</h2>
    </div>
  </div>
  <div class="row">
    {% if 'plotly_urls' in c[3] %}
    {% for url in c[3]['plotly_urls'] %}
    <div class="col-md-6">
      <div id="{{ c[2] }}_{{ loop.index }}_graph" style="width:580px;height:580px;"></div>
      <script>
          var data = {{ url|tojson|safe }};
          var elem = document.getElementById("{{ c[2] }}_{{ loop.index }}_graph");
          Plotly.plot(elem, data[0], data[1]);
      </script>
    </div>
    {% endfor %}
    {% endif %}
  </div>
  {% endif %}
  {% endfor %}
</div>
<script>
  $('#toggle_graphs').on('click', function (e) {
    var div_names = ["tree_row", "table_row", "main_header_graph", "main_header_all"];
    for (var i=0; i<div_names.length; i++) {
      var divs = document.getElementsByName(div_names[i]);
      for (var j=0; j<divs.length; j++) {
        if ($(divs[j]).is(":visible")) {
          $(divs[j]).hide();
          this.innerHTML = "Show All";
        } else {
          $(divs[j]).show();
          this.innerHTML = "Show Graphs Only";
        }
      }
    }
  });
</script>
{% endblock %}
