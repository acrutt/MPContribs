{% extends "layout.html" %}
{% block body %}

<nav class="navbar navbar-default navbar-lower" role="navigation">
  <div class="container">
    <form action="/contribute" method=post enctype=multipart/form-data class="navbar-form navbar-left">
      <div class="form-group">
        <select id="siteselect" data-placeholder="Select Site ..." style="width:180px;">
          <option></option>
          <option value="http://localhost:5000/test_site">Local Test Site</option>
          <option value="http://localhost:8000">Local Materials Project</option>
          <option value="https://www.materialsproject.org" disabled>Materials Project</option>
        </select>
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
      </div>
      <div class="form-group" style="position:relative; margin-left:50px;">
        <select id="dbselect" data-placeholder="Select DB ..." style="width:150px;">
          <option></option>
          <option value="default">default</option>
          <option value="contribs">contribs</option>
        </select>
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
      </div>
      <div class="form-group" style="position:relative; margin-left:50px;">
        <input type="text" class="form-control" name=apikey id=inputapikey placeholder="Insert API Key ...">
        <a id=dlnk href="http://localhost:5000/test_site/mpweb_core/dashboard" target="_blank">
          <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
        </a>
      </div>
      <input type=hidden name=site id=inputsite value=''>
      <input type=hidden name=dbtype id=inputdbtype value=''>
      <div class="form-group" style="position:relative; margin-left:50px;">
        <input type=submit name="submit" class="btn btn-primary navbar-btn" value="Go!">
        <input type="button" value="Cancel" class="btn btn-warning navbar-btn" onclick="stopLoad()"/>
      </div>
      <div class="form-group" style="position:relative; margin-left:50px;">
        {% if missing %}<code>{{ missing }}</code>{% endif %}
      </div>
    </form>
  </div>
</nav>

<style>
.affix { top: 68px; width:100%; z-index: 1000; }
.navbar-form { padding-left: 0; }
</style>

<script>
  $('.navbar-lower').affix({ offset: {top: -5} });
  $('#siteselect').chosen({ search_contains: true, disable_search_threshold: 10 });
  $('#dbselect').chosen({ search_contains: true, disable_search_threshold: 10 });
  function stopLoad() {
    if (navigator.appName == 'Microsoft Internet Explorer') {
      document.execCommand('Stop');
    } else { window.stop(); }
    alert('submission process aborted!');
  }
  // select options in siteselect and dbselect based on session.contribute
  var contrib = {{ session.contribute|tojson|safe }}; // dict: site, db, apikey
  if ( 'site' in contrib ) {
    $('#siteselect option[value="' + contrib['site'] + '"]').prop('selected', true);
  }
  $('#siteselect').trigger('chosen:updated');
  if ( 'dbtype' in contrib ) {
    $('#dbselect option[value="' + contrib['dbtype'] + '"]').prop('selected', true);
  }
  $('#dbselect').trigger('chosen:updated');
  if ( 'apikey' in contrib ) {
    document.getElementById('inputapikey').value = contrib['apikey'];
  }
  // on-change action for select option
  $('#siteselect').chosen().change(function () {
    document.getElementById('inputsite').value = this.value;
    var dlnk = document.getElementById('dlnk');
    dlnk.href = this.value + '/mpweb_core/dashboard';
  });
  $('#dbselect').chosen().change(function () {
    document.getElementById('inputdbtype').value = this.value;
  });
</script>

{% if content %}
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <div id='output' class="alert alert-warning alert-dismissible" role="alert"></div>
    </div>
  </div>
  {% for c in content: %}
  <script>$("#output").append("{{ c|safe }}");</script>
  {% endfor %}
</div>
{% endif %}

{% endblock %}
