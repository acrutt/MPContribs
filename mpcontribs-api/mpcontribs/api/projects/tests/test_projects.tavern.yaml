test_name: test projects resource

stages:
    - name: DTU project info and mask
      request:
          url: http://localhost:5000/projects/dtu/?_fields=project,title
          method: GET
      response:
          status_code: 200
          body:
              project: "dtu"
              title: "GLLB-SC Bandgaps"
    - name: projects search and mask
      request:
          url: http://localhost:5000/projects/?description__icontains=defect&_fields=project,title
          method: GET
      response:
          status_code: 200
          body:
              data:
                  - title: "Defect Genome PCFC"
                    project: "defect_genome_pcfc_materials"
                  - title: "Defect Physics of Air-Stable BiOI"
                    project: "bioi_defects"
    - name: DTU columns
      request:
          url: http://localhost:5000/projects/dtu/columns
          method: GET
      response:
          status_code: 200
          body:
              data:
                  - C
                  - ICSD
                  - formula
                  - ΔE-KS.direct
                  - ΔE-KS.indirect
                  - ΔE-QP.direct
                  - ΔE-QP.indirect
    - name: DTU table
      request:
          url: http://localhost:5000/projects/dtu/table?columns=formula,%CE%94E-KS.direct&page=1&per_page=2&q=Na&order=asc&sort_by=%CE%94E-KS.direct%20%5BeV%5D
          method: GET
      response:
          status_code: 200
          body:
              total_count: 242
              total_pages: 122
              page: 1
              last_page: 122
              per_page: 2
              items:
                  - identifier: "https://materialsproject.org/materials/mp-7433"
                    id: "http://localhost:8080/explorer/5abd8ffad4f144494f2cf1b4"
                    formula: "Cu2Na2Se2"
                    "ΔE-KS.direct [eV]": "0.139"
                  - identifier: "https://materialsproject.org/materials/mp-31593"
                    id: "http://localhost:8080/explorer/5abd8ffad4f144494f2cf1b7"
                    formula: "Co2Na8O8"
                    "ΔE-KS.direct [eV]": "0.177"
    - name: DTU graph
      request:
          url: http://localhost:5000/projects/dtu/graph?columns=%CE%94E-KS.direct&filters=%CE%94E-QP.direct__lt%3A0.2&page=1&per_page=2
          method: GET
      response:
          status_code: 200
          body:
              data:
                  - "x":
                      - "mp-15642"
                      - "mp-32447"
                    "y":
                      - "0.125"
                      - "0.142"
                    "text":
                      - "5a862206d4f1443a18fab255"
                      - "5a86220dd4f1443a18fab257"
    - name: create a project
      request:
          url: http://localhost:5000/projects/
          method: POST
          json:
              project: dmref
              title: Quasiparticle GW BandStructure
              authors: W. Lambrecht, S. Lyu, A.P. Jaroenjittichai
              description: >-
                  Band structure calculations were performed with the QSGW (quasiparticle self-consistent GW) approach
                  using the codes described in https://www.questaal.org/ using the method described in PhysRev B76,
                  165106 (2007) and PhysRevLett 96, 226402 (2006). The band structures use the 0.8Σ approximation,
                  meaning 0.8 of the self-energy is included. See Phys. Rev. Materials 2, 013807 (2018) for
                  justification.
              urls:
                  main: https://sites.google.com/a/case.edu/dmref/
                  PRB: https://doi.org/10.1103/PhysRevB.76.165106
                  PRL: https://doi.org/10.1103/PhysRevLett.96.226402
                  PRM: https://doi.org/10.1103/PhysRevMaterials.2.013807
      response:
          status_code: 200
          body:
              project: dmref
              title: Quasiparticle GW BandStructure
    - name: delete a project
      request:
          url: http://localhost:5000/projects/dmref/
          method: DELETE
      response:
          status_code: 200
