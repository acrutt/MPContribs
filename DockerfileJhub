FROM jupyterhub/jupyterhub:latest

WORKDIR /srv/jupyterhub

#COPY binder/environment.yml .
#RUN conda env update --file environment.yml --prune

COPY mpcontribs-client/requirements.txt requirements-client.txt
RUN pip install -r requirements-client.txt

ENV SETUPTOOLS_SCM_PRETEND_VERSION dev
COPY mpcontribs-client mpcontribs-client
RUN cd mpcontribs-client && pip install --upgrade -e .

RUN pip install jhub_remote_user_authenticator notebook nbgitpuller nbzip fargatespawner
RUN jupyter serverextension enable --py nbzip --sys-prefix
RUN jupyter nbextension install --user --py nbzip
RUN jupyter nbextension enable --user --py nbzip

#COPY logo.png /srv/jupyterhub/
COPY jupyterhub_config.py /srv/jupyterhub/jupyterhub_config.py

CMD ["jupyterhub", "-f", "/srv/jupyterhub/jupyterhub_config.py"]
