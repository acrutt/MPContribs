#!/usr/bin/env python

import os
import argparse
import logging
from pymatgen.matproj.rest import MPRester

#ENDPOINT, API_KEY = "https://www.materialsproject.org/rest", os.environ.get('MAPI_KEY')
ENDPOINT, API_KEY = "http://localhost:8000/rest", os.environ.get('MAPI_KEY_LOC')

def submit(args):
    with MPRester(API_KEY, endpoint=ENDPOINT) as m:
        print m.submit_mpfile(args.mpfile)

def main():
    parser = argparse.ArgumentParser(
        description="""mgc is a convenience script using the Materials Project's
        contribution framework MPContribs to submit user-contributed data to the
        MP for dissemination to MP users. For help on sub-commands: `mgc
        sub-command -h`.""",
        epilog='Author: Patrick Huck <phuck@lbl.gov> (LBNL)'
    )

    subparsers = parser.add_subparsers()
    parser_submit = subparsers.add_parser(
        'submit', help="""submit a physical MPFile containing the contribution
        data in MPContribs-specific format."""
    )
    parser_submit.add_argument('mpfile', type=str, help='MPFile to submit')
    parser_submit.set_defaults(func=submit)

    args = parser.parse_args()
    args.func(args)

if __name__ == "__main__":
    main()
